<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito | Tesoros de Ámbar</title>
    <link rel="stylesheet" href="../styles/comprar.css">
    <!-- Añadido BoxIcons para los iconos -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <!-- Header con navegación y logo -->
    <header>
        <div class="logo">
            <h1>Tesoros de Ámbar</h1>
        </div>
        <div class="header-right">
            <nav class="menu">
                <ul>
                    <li><a href="inicio.html">Inicio</a></li>
                    <li><a href="productos.html">Productos</a></li>
                    <li><a href="nosotros.html">Nosotros</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                </ul>
            </nav>
            <div class="carrito">
                <a href="comprar.html" class="icono-carrito">
                    <img src="../images/car.svg" alt="Carrito de compras">
                    <span class="contador" id="contador-carrito">0</span>
                </a>
            </div>
        </div>
    </header>

    <main class="contenedor-compra">
        <h1 class="titulo-seccion">Tu Carrito de Compras</h1>
        
        <div class="grid-compra">
            <div class="resumen-carrito">
                <h3><i class='bx bxs-cart'></i> Resumen del Pedido</h3>
                <div class="lista-productos" id="lista-productos">
                    <!-- Productos se cargarán aquí dinámicamente con JavaScript -->
                    <div class="mensaje-carrito-vacio" id="carrito-vacio">
                        <p>Tu carrito está vacío</p>
                        <a href="productos.html" class="boton-seguir-comprando">Ver productos</a>
                    </div>
                </div>
                <div class="total-carrito">
                    <div class="subtotal">
                        <span>Subtotal:</span>
                        <span id="precio-subtotal">$0.00</span>
                    </div>
                    <div class="envio">
                        <span>Envío:</span>
                        <span id="precio-envio">$0.00</span>
                    </div>
                    <div class="total">
                        <span>Total:</span>
                        <span id="precio-total">$0.00</span>
                    </div>
                    <button id="vaciar-carrito" class="boton-vaciar">Vaciar Carrito</button>
                </div>
            </div>

            <div class="columna-derecha">
                <form class="formulario-envio" id="formulario-envio">
                    <h3><i class='bx bxs-truck'></i> Información de Envío</h3>
                    <div class="grupo-formulario">
                        <label for="nombre">Nombre Completo</label>
                        <input type="text" id="nombre" required>
                    </div>
                    <div class="grupo-formulario">
                        <label for="email">Correo Electrónico</label>
                        <input type="email" id="email" required>
                    </div>
                    
                    <div class="grupo-formulario">
                        <label for="direccion">Dirección</label>
                        <input type="text" id="direccion" required>
                    </div>

                    <div class="grupo-formulario">
                        <label for="codigo-postal">Código Postal</label>
                        <input type="text" id="codigo-postal" pattern="\d{5}" required title="Por favor ingresa un código postal de 5 dígitos">
                    </div>
                    
                    <div class="grupo-formulario">
                        <label for="ciudad">Ciudad</label>
                        <input type="text" id="ciudad" required>
                    </div>
                    
                    <div class="grupo-formulario">
                        <label for="estado">Estado</label>
                        <select id="estado" required>
                            <option value="">Selecciona un estado</option>
                            <option value="Chiapas">Chiapas</option>
                            <option value="Ciudad de México">Ciudad de México</option>
                            <option value="Oaxaca">Oaxaca</option>
                            <!-- Añadir más estados de México según sea necesario -->
                        </select>
                    </div>
                    
                    <div class="grupo-formulario">
                        <label for="telefono">Teléfono</label>
                        <input type="tel" id="telefono" pattern="\d{10}" required title="Por favor ingresa un número de 10 dígitos">
                    </div>
                </form>

                <form class="formulario-pago" id="formulario-pago">
                    <h3><i class='bx bxs-credit-card'></i> Método de Pago</h3>
                    <div class="tipos-tarjeta">
                        <img src="../images/visa.svg" alt="Visa" class="tarjeta-icono">
                        <img src="../images/mastercard.svg" alt="MasterCard" class="tarjeta-icono">
                        <img src="../images/amex.svg" alt="American Express" class="tarjeta-icono">
                    </div>
                    <div class="grupo-formulario">
                        <label for="titular-tarjeta">Nombre del titular</label>
                        <input type="text" id="titular-tarjeta" required>
                    </div>
                    <div class="grupo-formulario">
                        <label for="numero-tarjeta">Número de Tarjeta</label>
                        <input type="text" id="numero-tarjeta" pattern="\d{15,16}" required placeholder="XXXX XXXX XXXX XXXX">
                    </div>
                    <div class="grupo-formulario-doble">
                        <div>
                            <label for="cvv">CVV</label>
                            <input type="text" id="cvv" pattern="\d{3,4}" required maxlength="4">
                        </div>
                        <div class="fecha-caducidad-container">
                            <label>Fecha de Caducidad</label>
                            <div class="fecha-caducidad">
                                <select id="mes-expiracion" required>
                                    <option value="">MM</option>
                                    <option value="01">01</option>
                                    <option value="02">02</option>
                                    <option value="03">03</option>
                                    <option value="04">04</option>
                                    <option value="05">05</option>
                                    <option value="06">06</option>
                                    <option value="07">07</option>
                                    <option value="08">08</option>
                                    <option value="09">09</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                </select>
                                <span>/</span>
                                <select id="ano-expiracion" required>
                                    <option value="">AAAA</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                    <option value="2030">2030</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="boton-pago-container">
                    <button class="boton-pagar" id="btn-pagar">Realizar Pago</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-container">
            <div class="footer-section">
                <h3>Contacto</h3>
                <ul>
                    <li><strong>Teléfono:</strong> +52 961 180 2144</li>
                    <li><strong>Email:</strong> tesorosdeambar@gmail.com</li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Información</h3>
                <ul>
                    <li><a href="nosotros.html" class="footer-link">¿Quiénes somos?</a></li>
                    <li><a href="politicas.html" class="footer-link">Políticas de privacidad</a></li>
                    <li><a href="envios.html" class="footer-link">Envíos y devoluciones</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Ubicación</h3>
                <ul>
                    <li>Dirección: Blvd. Belisario Domínguez Km. 1081, Sin Número, Terán, 29050<br>Tuxtla Gutiérrez, Chiapas</li>
                </ul>
            </div>
            
            <div class="footer-section social-section">
                <h3>Redes Sociales</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class='bx bxl-facebook-circle'></i></a>
                    <a href="#" aria-label="Instagram"><i class='bx bxl-instagram'></i></a>
                    <a href="#" aria-label="WhatsApp"><i class='bx bxl-whatsapp'></i></a>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>© 2025 Tesoros de Ámbar. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Modal de confirmación de pago -->
    <div id="modal-pago" class="modal-container">
        <div class="modal-contenido">
            <i class='bx bx-check-circle exito-icono'></i>
            <h3>¡Gracias por tu compra!</h3>
            <p>Tu pedido ha sido procesado exitosamente.</p>
            <p>Recibirás un correo electrónico con los detalles de tu compra.</p>
            <div class="modal-botones">
                <button id="aceptar-pago" class="boton-confirmar">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Script para la funcionalidad del carrito -->
    <script src="../scripts/carrito.js"></script>
    <script>
        // Script para manejar la validación de formularios y mostrar el modal
        document.addEventListener('DOMContentLoaded', function() {
            const btnPagar = document.getElementById('btn-pagar');
            const modalPago = document.getElementById('modal-pago');
            const btnAceptar = document.getElementById('aceptar-pago');
            const formEnvio = document.getElementById('formulario-envio');
            const formPago = document.getElementById('formulario-pago');
            const vaciarCarrito = document.getElementById('vaciar-carrito');
            
            // Evento para realizar el pago
            btnPagar.addEventListener('click', function() {
                // Validar que ambos formularios estén completos
                if (formEnvio.checkValidity() && formPago.checkValidity()) {
                    modalPago.style.display = 'flex';
                } else {
                    // Mostrar validaciones nativas del navegador
                    if (!formEnvio.checkValidity()) {
                        formEnvio.reportValidity();
                    } else {
                        formPago.reportValidity();
                    }
                }
            });
            
            // Cerrar modal y redireccionar
            btnAceptar.addEventListener('click', function() {
                modalPago.style.display = 'none';
                // Vaciar el carrito
                localStorage.removeItem('carrito');
                // Redireccionar a la página de inicio
                window.location.href = 'inicio.html';
            });
            
            // Vaciar carrito
            vaciarCarrito.addEventListener('click', function() {
                if (confirm('¿Estás seguro de que deseas vaciar tu carrito?')) {
                    localStorage.removeItem('carrito');
                    actualizarCarrito();
                }
            });
            
            // Función para actualizar el carrito
            function actualizarCarrito() {
                const listaProductos = document.getElementById('lista-productos');
                const contadorCarrito = document.getElementById('contador-carrito');
                const precioTotal = document.getElementById('precio-total');
                const precioSubtotal = document.getElementById('precio-subtotal');
                const precioEnvio = document.getElementById('precio-envio');
                const carritoVacio = document.getElementById('carrito-vacio');
                
                // Obtener carrito del localStorage
                const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
                
                // Actualizar contador
                contadorCarrito.textContent = carrito.length;
                
                // Mostrar mensaje si el carrito está vacío
                if (carrito.length === 0) {
                    listaProductos.innerHTML = '';
                    listaProductos.appendChild(carritoVacio);
                    precioSubtotal.textContent = '$0.00';
                    precioEnvio.textContent = '$0.00';
                    precioTotal.textContent = '$0.00';
                    btnPagar.disabled = true;
                    vaciarCarrito.disabled = true;
                } else {
                    // Ocultar mensaje de carrito vacío
                    carritoVacio.style.display = 'none';
                    btnPagar.disabled = false;
                    vaciarCarrito.disabled = false;
                    
                    // Calcular total
                    const subtotal = carrito.reduce((total, producto) => total + (producto.precio * producto.cantidad), 0);
                    const envio = subtotal > 1000 ? 0 : 150; // Envío gratis para compras mayores a $1000
                    const total = subtotal + envio;
                    
                    // Actualizar precios
                    precioSubtotal.textContent = `$${subtotal.toFixed(2)}`;
                    precioEnvio.textContent = envio === 0 ? 'GRATIS' : `$${envio.toFixed(2)}`;
                    precioTotal.textContent = `$${total.toFixed(2)}`;
                    
                    // Renderizar productos
                    listaProductos.innerHTML = '';
                    carrito.forEach(producto => {
                        const productoElement = document.createElement('div');
                        productoElement.className = 'producto-carrito';
                        productoElement.innerHTML = `
                            <div class="producto-info">
                                <img src="${producto.imagen}" alt="${producto.nombre}" class="producto-imagen">
                                <div>
                                    <h4>${producto.nombre}</h4>
                                    <p>$${producto.precio.toFixed(2)} x ${producto.cantidad}</p>
                                </div>
                            </div>
                            <div class="producto-acciones">
                                <button class="btn-eliminar" data-id="${producto.id}">
                                    <i class='bx bx-trash'></i>
                                </button>
                            </div>
                        `;
                        listaProductos.appendChild(productoElement);
                    });
                    
                    // Añadir eventos para eliminar productos
                    document.querySelectorAll('.btn-eliminar').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const id = this.getAttribute('data-id');
                            eliminarProducto(id);
                        });
                    });
                }
            }
            
            // Función para eliminar un producto del carrito
            function eliminarProducto(id) {
                let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
                carrito = carrito.filter(producto => producto.id !== id);
                localStorage.setItem('carrito', JSON.stringify(carrito));
                actualizarCarrito();
            }
            
            // Inicializar carrito al cargar la página
            actualizarCarrito();
        });
    </script>
</body>
</html>